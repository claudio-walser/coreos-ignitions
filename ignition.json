{
  "ignition": { "version": "2.2.0" },
  "passwd": {
    "users": [
      {
        "name": "claudio",
        "sshAuthorizedKeys": [
          "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCyvOm1lNZQDREfzZyTrR3rFXlqOkcg/gm0qj0Bohi/KSBNrY3Lb2b/7XtAGc6kp4DOYwvyH0I6GxAkQP6heA72OYd3T0sSK/RcMFQHW0DAVTV6CiRhCUV4fKwS57hnZ02sEP3on7gaCD5Mf8gm+zwSoLa+jgZ2MMQrwIz+BcE2rXrMXuPF4QAn9SHSpKA+ja8V/o89Dt4J58awWe3MsccpEnnvkyGoNb82h+Xl96OrCO1Kw5fiuk0LbOs5iVEnxu6rDcU0KFphE4Ggep/BtVPjSwYQDn3fAZ0z3TAUOisi7o+2tY8dq8+AuuvgsUnwpaiUQHpDlxurK5ZQ0/YFzxlVqq1Dm2rk1tuum7xhjimc5HbC5Jq+f7cB9C5MfC7I+uVfjS7PILqY+JEvayTr7C8tYEqD0hF/mmnePLMvTdnL6E5dpkkLKw9DjL3PGpn1KSlspGfY3GRkjzdiMUtrDDym42EflqJn3zAGlm8ZlA2INmOmUgeNr1JJTK2AjycqYIB/GVgG/J6kqf9HaFijGwuSxlyGq3OajKNgtL/WYhpK1O88FXV3rYi03CeG1kdQ3okigibuY+OnKsviUGlOwD+9BHnMnM1exfIYkpflAWI9GxGgFpM7RFuA3Mbag3KeJ0pM7zz+KBPeuSgubVpgpvRe3sIQQ6EWt77kgYk6Ma7C7w== claudio@net-sec.local",
          "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDUNQfEB9pqy3yQ53sJEsczgFBYzP+Lvfrz/wlQ+4iR3yBce9s4ZO8I8GEFfaxbHAJEc5fAx0rhOd4QKC/XHF2KT+nBq/gGXQjvmxgVDzJU6lOLMQhV1WQNo4xaBmoN5VKSWWuB+Jv3ipF28WzhbBHQZ8BqCZEo9h+M4olmlN+XZnrcrXwU4ct9VPsy77yVI134HVJGiHLrlXUUvgJ0Bdh32C1RCYSgyo5zzgtxU24ldFiqSYSCqwJ+EQWE0ejnY1oNFU2A0KGtSrzmKfrus2xbxPfgAVZqJSJw5PId9DknsbAIW4Wv1xPG+UsbIboKn7anDffmHLYr6Qwal3DjW2nt/j9MsQhyzWw4rh+PKQFI/e9A3g8a0gTnV/4cpFIgeX8wWfomGKE0zXnZaIORLWCwz+z5fYtFT5d5JipNctnjEQObk1wX5sRroYfPGG012cCcY8nQN4WSUul/SCTrfC9EGozb4FwUc5IknL9OfOF5jYDeU15rQkeIdDRXQiwvmEl6vDwzgo3ZwBT5ha8uw2RP7Z3nE67zGCiO5QgBBLoU28fHeBbPPeB09yv9oX3d9gkxcYXdWjSsT9nUzTtcdMFfG29YAhnXkqPrzl2npaL8v3EbkDLmNA8bm7EKLHPJoJTMcqVN3HAtX5ACbaqQtAyNJbyxHTerOAQHeR6YdssirQ== claudio.walser@srf.ch"
        ],
        "groups": [ "sudo", "docker" ]
      }
    ]
  },
  "networkd": {
    "units": [{
      "name": "00-enp0s3.network",
      "contents": "[Match]\nName=enp0s3\n\n[Network]\nAddress=192.168.43.51\nGateway=192.168.43.1\nDNS=8.8.8.8\nDNS=8.8.4.4\n"
    }]
  },
  "storage": {
    "files": [{
      "filesystem": "root",
      "path": "/etc/hostname",
      "mode": 420,
      "contents": { "source": "data:,master-1" }
    }]
  },

  "systemd": {
      "units": [
        {
          "enable": true,
          "name": "docker.service"
        }, {
          "name": "haproxy.service",
          "enabled": true,
          "contents": "[Unit]\nDescription=Haproxy in a Container\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nTimeoutStartSec=0\nRestart=always\nUser=claudio\nGroup=claudio\nExecStartPre=-/usr/bin/docker pull walser/haproxy:latest\nExecStartPre=-/usr/bin/docker kill haproxy\nExecStartPre=-/usr/bin/docker rm haproxy\nExecStart=/usr/bin/docker run -p 8080:8080 -p 6444:6443 -e LB_HOST=master-1 --name haproxy walser/haproxy:latest\nExecStop=/usr/bin/docker kill haproxy\nExecStopPost=-/usr/bin/docker rm haproxy\n\n[Install]\nWantedBy=multi-user.target\n"
        }, {
          "name": "keepalived.service",
          "enabled": true,
          "contents": "[Unit]\nDescription=keepalived in a Container\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nTimeoutStartSec=0\nRestart=always\nUser=claudio\nGroup=claudio\nExecStartPre=-/usr/bin/docker pull arcts/keepalived:latest\nExecStartPre=-/usr/bin/docker kill keepalived\nExecStartPre=-/usr/bin/docker rm keepalived\nExecStart=/usr/bin/docker run --net=host --cap-add NET_ADMIN -e KEEPALIVED_AUTOCONF=true -e KEEPALIVED_STATE=MASTER -e KEEPALIVED_INTERFACE=enp0s3 -e KEEPALIVED_VIRTUAL_ROUTER_ID=1 -e KEEPALIVED_UNICAST_SRC_IP=192.168.43.51 -e KEEPALIVED_UNICAST_PEER_0=192.168.43.52 -e KEEPALIVED_UNICAST_PEER_1=192.168.43.53 -e KEEPALIVED_TRACK_INTERFACE_1=enp0s3 -e KEEPALIVED_VIRTUAL_IPADDRESS_1=\"192.168.43.50/24 dev enp0s3\" --name keepalived arcts/keepalived:latest\nExecStop=/usr/bin/docker kill keepalived\nExecStopPost=-/usr/bin/docker rm keepalived\n\n[Install]\nWantedBy=multi-user.target\n"
        }
      ]
    }

}
